<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<nxthemes:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:nxthemes="http://nuxeo.org/nxthemes"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    xmlns:nxh="http://nuxeo.org/nxweb/html"
    xmlns:nxu="http://nuxeo.org/nxweb/util"
    xmlns:nxl="http://nuxeo.org/nxforms/layout"
    xmlns:nxd="http://nuxeo.org/nxweb/document">
    
	<ui:define name="stylesheets">
		<link href="#{baseURL}css/toutatice-popup.min.css" type="text/css"
			rel="stylesheet" />
		<link href="#{baseURL}css/glyphicons/css/glyphicons.css" type="text/css"
	    	rel="stylesheet" />
		<link rel="stylesheet"
	        href="#{baseURL}css/jqyFileupload/jquery.fileupload.css" />
	    <link rel="stylesheet"
	        href="#{baseURL}css/jqyFileupload/jquery.fileupload-ui.css" />
	</ui:define>    
	
    <ui:define name="header_scripts">
		<script src="#{baseURL}javax.faces.resource/jsf.js.faces?ln=javax.faces" type="text/javascript" />

		<script src="#{baseURL}nxthemes-lib/jquery.js" />
		<script src="#{baseURL}nxthemes-lib/prototype.js" />
		    	
    	<script
            src="#{baseURL}org.richfaces.resources/javax.faces.resource/org.richfaces.staticResource/4.5.0.Alpha3/PackedCompressed/org.richfaces/jquery.js"
            type="text/javascript"></script>
		    	
		<script type="text/javascript">
			var $JQry = jQuery.noConflict();
			$JQry(window).load(function() {
		    	$JQry(".pictures-list > .row").each(function(index, element) {
		    		var img = $JQry(element).find(".thumbnail > img");
		    		var $title = $JQry(element).find("h4");
		    		$title.append(" ("+img.prop("naturalWidth")+"x"+img.prop("naturalHeight")+")");
		    	});
		    });
		</script>
    </ui:define>
    
    <ui:define name="body">
    	<div class="container">
	        <div class="form-group">
			 <fieldset>
				<legend>
	            			<h3>#{messages['toutatice.label.imageUpload.attachableImagesTab']}</h3>
				</legend>
			</fieldset>
	        </div>
	        <c:if test="#{editorImageActions.inToutaticeCreationMode}">
		        <div class="alert alert-warning">
		            <i class="glyphicons halflings warning-sign"></i> 
		            <span class="text-warning">#{messages['label.imageUpload.unableToUpload']}</span>
		        </div>
		    </c:if>
			<h:form id="uploadForm" class="form form-horizontal" enctype="multipart/form-data" disableDoubleClickShield="true" role="form">
		        <c:choose>
					<c:when test="#{empty currentDocument.toutatice.images}">
						<div class="alert alert-warning">
							<i class="glyphicons halflings warning-sign"></i> <span
								class="text-warning">#{messages['toutatice.label.imageUpload.choose.NoattachedImage']}</span>
						</div>
					</c:when>
					<c:otherwise>
							<div class="pictures-list">
							
								<c:set var="ttcImagesConstraints" value="#{fn:split(config.getWebsiteParamString('ttcImagesConstraints','150x150'), ',')}" />
							
								<ui:repeat var="img" value="#{currentDocument.toutatice.images}" varStatus="status">
									<ui:fragment rendered="#{not empty img.filename}">
										<div class="row">
											<div class="col-sm-6">
												<div class="thumbnail">
													<img src="#{nxd:complexFileUrl('downloadFile', currentDocument, 'ttc:images', status.index, 'file', img.filename)}" />
												</div>
											</div>
											<div class="col-sm-6">
												<h4>#{nxd:fileDescription(currentDocument, "ttc:images/".concat(status.index).concat("/file"), "ttc:images/".concat(status.index).concat("/filename"), "image")}</h4>
												
												
												<ui:repeat var="resConstraint" value="#{ttcImagesConstraints}" varStatus="resStatus">
													<p><h:commandLink
							                            action="#{documentActions.constraintImage(status.index, resConstraint)}"
							                            class="btn btn-default">
				                                        <i class="glyphicons halflings resize-small"></i> #{messages['osivia.edit.attachments.constraint']} #{resConstraint}
			                                    	</h:commandLink></p>
												</ui:repeat>
												
												<p><h:commandLink
						                            action="#{documentActions.deleteImage(status.index)}"
						                            class="btn btn-default">
			                                        <i class="glyphicons halflings remove"></i> #{messages['osivia.edit.attachments.delete']}
		                                    	</h:commandLink></p>
											</div>
										</div>
										<ui:fragment rendered="#{not status.last}">
											<hr></hr>
										</ui:fragment>
									</ui:fragment>
								</ui:repeat>
							</div>
							<h:inputHidden name="fromUrl" value="#{pageBean.fromUrl}" />
					</c:otherwise>
				</c:choose>
			</h:form>
	    </div>
    </ui:define>
    
</nxthemes:composition>